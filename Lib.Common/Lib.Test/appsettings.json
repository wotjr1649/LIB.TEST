{
  "ConnectionStrings": {
    "Main": "Server=127.0.0.1,1433;Database=SORTER_TEST;User ID=sa;Password=123456;Max Pool Size=10000;Connect Timeout=60;TrustServerCertificate=True",
    "Reporting": "Server=127.0.0.1,1433;Database=SORTER_TEST;User ID=sa;Password=123456;Max Pool Size=10000;Connect Timeout=60;TrustServerCertificate=True"
  },

  "LibLog": {
    "Rooting": {
      "Rules": [
        // 추가: Error 루트 규칙(최상위에서 우선 매칭)
        {
          "Root": "Error", // tuned: Error 로그는 별도 폴더로 분리 저장
          "MinLevel": "Error"
        },
        {
          "Root": "Result",
          "Categories": [ "result", "Result" ]
        },
        {
          "Root": "Log",
          "Categories": [ "Application", "Db", "Jb", "*" ]
        }
      ]
    },

    "Partitions": {
      // 권장 튜닝: 4샤드, 150ms 플러시, 배치 128, 큐 용량 4000(초당 ~2~3천 lps 목표)
      "Default": {
        "Shards": 4, // tuned: 병렬 소비자 수(코어/카테고리 분포에 맞춰 2~4 권장)
        "QueueCapacity": 4000, // tuned: TPS×(Flush/1000)×안전계수(3~5)
        "BatchSize": 128, // tuned: 파일·DB 모두 효율적인 범위(64~256)
        "FlushIntervalMs": 150, // tuned: 지연/IO 타협(100~300)
        "Backpressure": "Block" // tuned: 핵심 로깅은 Block 권장
      }
    },

    "Local": {
      "Enabled": true,
      "Directory": "C:\\Users\\js\\Documents\\LOG",
      "FileTemplate": "{Root}/{yyyy}-{MM}-{dd}/{Category}{DeviceId?}.log"
    },

    "Database": {
      "Enabled": true,
      "ConnectionStringName": "Reporting",
      "AutoCreateTable": true, // tuned: 초도 기동 시 테이블 보장
      "BatchSize": 500, // tuned: BulkCopy 배치(200~1000 권장)
      "MaxConcurrency": 1, //  tuned: 로컬 MSSQL은 1~2가 안정적
      "TableName": "IF_LOG"
    }
  },
  "LibDb": {
    // ✅ 라이브러리의 루트 옵션
    "DefaultConnectionString": "", // ↙︎ 아래 Name로부터 자동 주입(코드에서 처리)
    "DefaultConnectionStringName": "Main", // ConnectionStrings:Main 를 사용하고 싶을 때

    "Sql": {
      "CommandTimeout": "00:00:45", // TimeSpan 형식
      "DefaultReadUncommitted": true, // Text 쿼리 앞에 RU 프리픽스
      "ForceRuForStoredProcedure": true // SP는 세션 단발성 RU 적용
    },

    "Resilience": {
      "MaxRetryAttempts": 3, // Polly 재시도 횟수
      "BaseDelay": "00:00:00.200", // 기본 지연
      "UseJitter": true, // 지터 적용
      "MaxDelay": "00:00:03", // 최대 지연
      "TimeoutPerAttempt": "00:00:05" // 시도당 타임아웃
      // UseCircuitBreaker / CircuitBreakDuration 을 쓰려면
      // ResilienceOptions 에 해당 속성이 실제로 정의되어 있어야 합니다.
    },

    "Diagnostics": {
      "SampleRate": 1.0, // 0~1
      "CommandTextMaxLength": 800,
      "LogOnSuccess": true,
      "LogOnFailure": true
    }
  }
}





